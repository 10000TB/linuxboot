#!/bin/sh
# Sign a valid directory of kexec params
. /etc/functions

MEDIA="$1"

if [ -z "$MEDIA" ]; then
	die "Usage: $0 /boot "
fi

confirm_gpg_card

for tries in 1 2 3; do
	if sha256sum `find $MEDIA/kexec*.txt` | gpg \
		--digest-algo SHA256 \
		--detach-sign \
		-a \
		> $MEDIA/kexec.sig \
	; then
		exit 0
	fi
done

warn "$MEDIA: Unable to sign boot hashes"
exit 1
